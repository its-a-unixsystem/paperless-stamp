{"id":"paperless-stamp-zyg","title":"Paperless-Stamp MVP","description":"Implement the full Paperless-Stamp sidecar extension as defined in stamp-prd.md. A polling worker that stamps PDFs in Paperless-ngx, plus a FastAPI+HTMX web UI for config, preview, and history.","status":"open","priority":1,"issue_type":"epic","owner":"thomas@februus.net","created_at":"2026-02-18T15:47:24.218265885+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:47:24.218265885+01:00"}
{"id":"paperless-stamp-zyg.1","title":"M1: API spike + project skeleton","description":"Resolve all 3 open questions from stamp-prd.md §9 and set up the project structure.\n\n## Deliverables\n- Python project with pyproject.toml (deps: pikepdf, reportlab, fastapi, httpx, jinja2)\n- Paperless API client module (httpx-based) that can:\n  1. Authenticate with PAPERLESS_TOKEN\n  2. List documents filtered by tag prefix (validate exact filter syntax)\n  3. Download a document's archive file (or original fallback)\n  4. Upload/replace an archive file (validate this works; document fallback if not)\n  5. Update tags on a document (add/remove)\n  6. Add a note to a document\n  7. Read custom field values\n- Integration test script that runs against a real Paperless-ngx instance\n\n## Acceptance Criteria\n- [ ] Can connect to Paperless-ngx and list documents with stamp:* tags\n- [ ] Can download archive file for a document\n- [ ] Can upload a modified PDF as the archive file and see it in Paperless UI\n- [ ] Can add/remove tags on a document\n- [ ] Can read custom field values (Paid Date, Received Date)\n- [ ] Can add notes to a document\n- [ ] Open questions 1-3 from PRD §9 are resolved and documented","status":"closed","priority":1,"issue_type":"feature","assignee":"Thomas","owner":"thomas@februus.net","created_at":"2026-02-18T15:47:36.329866305+01:00","created_by":"Thomas","updated_at":"2026-02-18T20:23:05.397368688+01:00","closed_at":"2026-02-18T20:23:05.397368688+01:00","close_reason":"Closed","dependencies":[{"issue_id":"paperless-stamp-zyg.1","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:47:36.330694739+01:00","created_by":"Thomas"}]}
{"id":"paperless-stamp-zyg.2","title":"M2: Stamp generation (ReportLab + pikepdf)","description":"Build the stamp overlay generator and PDF merger as standalone modules.\n\n## Deliverables\n- Stamp overlay generator using ReportLab:\n  - Bold Courier text, uppercase, configurable per stamp type\n  - Optional date line (ISO 8601 format)\n  - Double-line rectangular border with subtle ink texture (fuzzy edges via multi-stroke)\n  - 50% opacity, configurable color (default Ink Blue #003399)\n  - Deterministic tilt ±3° seeded by document ID hash\n  - Size: ~20% of page width\n- PDF merger using pikepdf:\n  - Merge stamp overlay onto page 1 of target PDF\n  - Support multiple stamps with vertical offset (stacking)\n  - Position: top-right, 10% offset from top and right edges\n- CLI test script: takes a PDF + stamp params, outputs stamped PDF\n\n## Acceptance Criteria\n- [ ] Running the CLI script on a sample PDF produces a visually correct stamped PDF\n- [ ] Stamp has double border with ink texture (fuzzy edges)\n- [ ] Tilt is deterministic: same doc ID always produces same angle\n- [ ] Multiple stamps stack vertically without overlap\n- [ ] Stamp without date omits the date line (no blank space)\n- [ ] Stamp renders correctly on both A4 and Letter page sizes\n- [ ] Color is configurable per invocation","status":"open","priority":1,"issue_type":"feature","owner":"thomas@februus.net","created_at":"2026-02-18T15:47:48.525349062+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:47:48.525349062+01:00","dependencies":[{"issue_id":"paperless-stamp-zyg.2","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:47:48.526159733+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.2","depends_on_id":"paperless-stamp-zyg.1","type":"blocks","created_at":"2026-02-18T15:48:42.547494886+01:00","created_by":"Thomas"}]}
{"id":"paperless-stamp-zyg.3","title":"M3: Worker loop (end-to-end stamping)","description":"Wire the API client (M1) and stamp generator (M2) into a polling worker loop.\n\n## Deliverables\n- Worker module that runs the full pipeline:\n  1. Poll Paperless for documents with stamp:* tags (configurable interval, default 60s)\n  2. For each document: fetch archive PDF + custom field values\n  3. For each stamp:* tag: resolve stamp text, color, date field\n  4. Generate stamp overlays, merge onto page 1\n  5. Upload stamped PDF as archive file\n  6. Remove trigger tags, add stamped:* done tags\n  7. On error: remove trigger tag, add stamp:error tag, attach note\n- Logging to stdout (structured, with document ID and stamp type)\n- Runnable as: python -m paperless_stamp\n\n## Acceptance Criteria\n- [ ] Tag a document stamp:paid in Paperless → stamp appears on archive within one poll cycle\n- [ ] stamp:paid tag removed, stamped:paid tag added after successful stamp\n- [ ] Paid Date custom field value appears on stamp when set\n- [ ] stamp:received uses document created date as fallback when Received Date is empty\n- [ ] Multiple stamp tags on one document produce stacked stamps\n- [ ] Encrypted PDF triggers stamp:error tag + note with error description\n- [ ] Already-stamped documents (with stamped:* tag) are never re-processed\n- [ ] Worker recovers gracefully from transient API errors (logs and continues)","status":"open","priority":1,"issue_type":"feature","owner":"thomas@februus.net","created_at":"2026-02-18T15:48:02.291990305+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:48:02.291990305+01:00","dependencies":[{"issue_id":"paperless-stamp-zyg.3","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:48:02.292794003+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.3","depends_on_id":"paperless-stamp-zyg.1","type":"blocks","created_at":"2026-02-18T15:48:42.593366356+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.3","depends_on_id":"paperless-stamp-zyg.2","type":"blocks","created_at":"2026-02-18T15:48:42.641745311+01:00","created_by":"Thomas"}]}
{"id":"paperless-stamp-zyg.4","title":"M4: Config system + SQLite","description":"Implement the configuration layer and stamp history database.\n\n## Deliverables\n- Config module with 3-tier priority: SQLite (highest) → env vars → defaults\n- SQLite database at /app/data/stamp.db (configurable path via STAMP_DB_PATH)\n- Schema from PRD §4.4:\n  - config table: key/value store for runtime settings\n  - stamp_history table: log of all stamp operations\n- Config keys: poll_interval, default_color, color.paid, color.received, text.paid, text.received, date_field.paid, date_field.received, received_date_fallback\n- History logging integrated into worker: write a row on every stamp attempt (success or error)\n- All env vars from PRD §4.2 configuration table supported\n\n## Acceptance Criteria\n- [ ] Worker reads STAMP_POLL_INTERVAL from env and uses it\n- [ ] Inserting a row in config table overrides the env var value on next poll cycle\n- [ ] stamp_history table populated after each stamp operation\n- [ ] History includes: document_id, document_title, stamp_type, stamp_text, stamp_date, status, error_message, processing_ms\n- [ ] Default values work when no env vars or DB config are set\n- [ ] Database is auto-created on first run","status":"open","priority":1,"issue_type":"feature","owner":"thomas@februus.net","created_at":"2026-02-18T15:48:14.392038354+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:48:14.392038354+01:00","dependencies":[{"issue_id":"paperless-stamp-zyg.4","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:48:14.39282459+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.4","depends_on_id":"paperless-stamp-zyg.3","type":"blocks","created_at":"2026-02-18T15:48:42.685382048+01:00","created_by":"Thomas"}]}
{"id":"paperless-stamp-zyg.5","title":"M5: Web UI (FastAPI + HTMX)","description":"Build the web configuration interface with 3 pages.\n\n## Deliverables\n- FastAPI app served on STAMP_UI_PORT (default 8585)\n- Jinja2 templates with HTMX for interactivity, no JS build step\n- Shared layout: nav bar with Config | Preview | History tabs, worker status indicator\n\n### A. Configuration page (/)\n- General settings: poll interval, default color\n- Stamp types table: per-type text, color, date field name\n- Received date fallback toggle (document created vs none)\n- Save button writes to SQLite config table\n- Worker status: running/stopped, time since last poll\n\n### B. Preview page (/preview)\n- Document search (by title or ID, queries Paperless API)\n- Stamp type selector, optional date override\n- Generates stamp preview (stamped PDF rendered as image or embedded PDF)\n- 'Apply Stamp' button triggers actual stamping\n- 'Download Preview' button downloads the stamped PDF without applying\n\n### C. History page (/history)\n- Table: time (relative), document title (linked to Paperless), type, status, duration\n- Expandable error messages for failed stamps\n- Filter by status (all/success/error) and stamp type\n- Pagination (50 per page)\n\n## Acceptance Criteria\n- [ ] Config page loads and shows current settings from DB + env defaults\n- [ ] Saving config updates SQLite and worker picks up changes on next cycle\n- [ ] Preview page can search for a document and show stamp preview\n- [ ] Apply button stamps the document and redirects to history\n- [ ] History page shows recent operations with correct status indicators\n- [ ] Error rows are expandable to show error message\n- [ ] All pages work without JavaScript disabled (HTMX progressive enhancement)\n- [ ] No authentication (network-level security only, per PRD §4.7)","status":"open","priority":1,"issue_type":"feature","owner":"thomas@februus.net","created_at":"2026-02-18T15:48:28.733646214+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:48:28.733646214+01:00","dependencies":[{"issue_id":"paperless-stamp-zyg.5","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:48:28.734431187+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.5","depends_on_id":"paperless-stamp-zyg.4","type":"blocks","created_at":"2026-02-18T15:48:42.731529165+01:00","created_by":"Thomas"}]}
{"id":"paperless-stamp-zyg.6","title":"M6: Packaging + Docker","description":"Package for Docker and standalone pip install.\n\n## Deliverables\n- Dockerfile (multi-stage, slim Python base)\n- docker-compose.yml example (as shown in PRD §5.1)\n- pyproject.toml with console_scripts entry point: paperless-stamp\n- Standalone mode: pip install paperless-stamp \u0026\u0026 paperless-stamp\n- Health check endpoint: GET /health returns worker status + last poll time\n- Startup validation: check Paperless-ngx connectivity and API capabilities before entering poll loop\n\n## Acceptance Criteria\n- [ ] docker compose up starts the worker + web UI\n- [ ] Stamping works end-to-end from Docker container\n- [ ] Web UI accessible at configured port from host\n- [ ] pip install . \u0026\u0026 paperless-stamp works in a fresh venv\n- [ ] Startup fails fast with clear error if PAPERLESS_URL or PAPERLESS_TOKEN are missing\n- [ ] /health endpoint returns JSON with worker status","status":"open","priority":1,"issue_type":"feature","owner":"thomas@februus.net","created_at":"2026-02-18T15:48:36.899712924+01:00","created_by":"Thomas","updated_at":"2026-02-18T15:48:36.899712924+01:00","dependencies":[{"issue_id":"paperless-stamp-zyg.6","depends_on_id":"paperless-stamp-zyg","type":"parent-child","created_at":"2026-02-18T15:48:36.900465777+01:00","created_by":"Thomas"},{"issue_id":"paperless-stamp-zyg.6","depends_on_id":"paperless-stamp-zyg.5","type":"blocks","created_at":"2026-02-18T15:48:42.777777282+01:00","created_by":"Thomas"}]}
